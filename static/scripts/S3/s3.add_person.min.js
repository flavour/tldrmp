(function(){S3.addPersonWidget=function(b){var a="#"+b,d=$(a),m=d.next(".error_wrapper"),n=$(a+"_title__row"),k=$(a+"_full_name__row"),l=$(a+"_date_of_birth__row"),h=$(a+"_gender__row"),f=$(a+"_occupation__row"),c=$(a+"_email__row"),g=$(a+"_mobile_phone__row"),e=$(a+"_box_bottom");$(a+"__row").hide().after(e).after(g).after(c).after(f).after(h).after(l).after(k).after(n).after(m);n.show();k.show();l.show();h.show();f.show();c.show();g.show();e.show();d.val()?p(b):q(b);$("form").submit(function(){S3ClearNavigateAwayConfirm();
r(b);return!0})};var r=function(b){var a="#"+b;$(a+"_full_name").prop("disabled",!1);$(a+"_gender").prop("disabled",!1);$(a+"_date_of_birth").prop("disabled",!1);$(a+"_occupation").prop("disabled",!1);$(a+"_email").prop("disabled",!1);$(a+"_mobile_phone").prop("disabled",!1);$(a+"_edit_bar .icon-edit").hide();q(b)},p=function(b){var a="#"+b;$(a+"_full_name").prop("disabled",!0);$(a+"_gender").prop("disabled",!0);$(a+"_date_of_birth").prop("disabled",!0);$(a+"_occupation").prop("disabled",!0);$(a+
"_email").prop("disabled",!0);$(a+"_mobile_phone").prop("disabled",!0);$(a+"_edit_bar").removeClass("hide").show();$(a+"_edit_bar .icon-edit").click(function(){r(b)});$(a+"_edit_bar .icon-remove").click(function(){s(b)})},s=function(b){b="#"+b;$(b).val("");$(b+"_full_name").prop("disabled",!1).val("");$(b+"_gender").prop("disabled",!1).val("");$(b+"_date_of_birth").prop("disabled",!1).val("");$(b+"_occupation").prop("disabled",!1).val("");$(b+"_email").prop("disabled",!1).val("");$(b+"_mobile_phone").prop("disabled",
!1).val("");$(b+"_edit_bar").hide()},q=function(b){var a="#"+b,d=$(a+"_full_name");if(!d.attr("autocomplete")){var m=$(a),n=d.attr("data-c");$(a+"_full_name").after('<div id="'+b+'_throbber" class="throbber hide"></div>');var k=$(a+"_throbber"),l=S3.Ap.concat("/"+n+"/person/search_ac"),h=d.val(),f=!1;d.autocomplete({delay:450,minLength:2,source:function(a,b){$.ajax({url:l,data:{term:a.term}}).done(function(a){var c=0==a.length?i18n.no_matching_records:i18n.none_of_the_above;a.push({id:0,value:"",
label:c,first:c});b(a)})},search:function(a,b){d.hide();k.removeClass("hide").show();return!0},response:function(a,b,e){k.hide();d.show();return e},focus:function(a,b){return!1},select:function(a,g){var e=g.item;if(e.id){var l=e.first;e.middle&&(l+=" "+e.middle);e.last&&(l+=" "+e.last);d.val(l);m.val(e.id);t(b,e.id)}else m.val("");f=!0;return!1}}).data("ui-autocomplete")._renderItem=function(a,b){var d=b.first;b.middle&&(d+=" "+b.middle);b.last&&(d+=" "+b.last);return $("<li>").data("item.autocomplete",
b).append("<a>"+d+"</a>").appendTo(a)};d.blur(function(){d.val()||(m.val(""),f=!0);f?h=d.val():d.val(h);f=!1})}},t=function(b,a){s(b);var d="#"+b,m=$(d),n=$(d+"_full_name"),k=n.attr("data-c"),k=S3.Ap.concat("/"+k+"/person/"+a+".s3json?show_ids=True");$.getJSONS3(k,function(a){try{var h=void 0,f=void 0,c=a.$_pr_person[0];p(b);m.val(c["@id"]);a=[];c.hasOwnProperty("first_name")&&a.push(c.first_name);c.hasOwnProperty("middle_name")&&a.push(c.middle_name["@value"]);c.hasOwnProperty("last_name")&&a.push(c.last_name["@value"]);
n.val(a.join(" "));c.hasOwnProperty("gender")&&$(d+"_gender").val(c.gender["@value"]);c.hasOwnProperty("date_of_birth")&&$(d+"_date_of_birth").val(c.date_of_birth["@value"]);c.hasOwnProperty("occupation")&&$(d+"_occupation").val(c.occupation["@value"]);if(c.hasOwnProperty("$_pr_email_contact"))var g=c.$_pr_email_contact[0],h=g.value["@value"];c.hasOwnProperty("$_pr_phone_contact")&&(g=c.$_pr_phone_contact[0],f=g.value["@value"]);if(c.hasOwnProperty("$_pr_contact"))for(var e=c.$_pr_contact,c=0;c<e.length;c++)g=
e[c],void 0==h&&"EMAIL"==g.contact_method["@value"]&&(h=g.value["@value"]),void 0==f&&"SMS"==g.contact_method["@value"]&&(f=g.value["@value"]);void 0!==h&&$(d+"_email").val(h);void 0!==f&&$(d+"_mobile_phone").val(f)}catch(k){m.val("")}})}})();
