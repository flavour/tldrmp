function s3_popup_refresh_main_form(){var b=getQueryParams(document.location.search);if("undefined"!=typeof b.level)self.parent.s3_popup_remove();else{var d=b.caller;s3_debug("caller",d);var c=b.person_id;if("undefined"!=typeof c)"undefined"!=typeof d&&self.parent.$("#"+d).val(c).change(),self.parent.s3_popup_remove();else{var c=RegExp(".*\\"+S3.Ap+"\\/"),a=b.child,i;"undefined"===typeof a?(a=(new String(self.location)).replace(c,""),a=a.split("?")[0].split("/"),i=a[1]+"_id"):i=a;s3_debug("child_resource",
i);b=b.parent;if("undefined"===typeof b){b=d.replace("_"+i,"");s3_debug("parent_field",b);var a=b.replace(/_.*/,""),b=b.replace(a+"_",""),a=new String(self.parent.location),a=a.replace(c,""),a=a.split("?")[0].split("/"),f=null,c=a[0],l=a[1];2<a.length&&(null!==a[2].match(/\d*/)?3<a.length&&(f=a[3]):f=a[2]);null!==f&&b!=l&&b==f&&(b=l+"/"+f)}else a=new String(self.parent.location),a=a.replace(c,""),a=a.split("?")[0].split("/"),c=a[0];s3_debug("parent_resource",b);s3_debug("caller_prefix",c);var c=S3.Ap.concat("/"+
c+"/"+b+"/options.s3json?field="+i),j=self.parent.$("#"+d);s3_debug("selector",j);var t="sub_"==d.substring(0,4),p=self.parent.$("#dummy_"+d),q=void 0!=p.val();s3_debug("has_dummy",q);var n=j.hasClass("checkboxes-widget-s3"),e;if(n){var u=self.parent.$("#"+d+" tbody tr:first").children().length;e=[]}else{var r=self.parent.$("#"+d+" >option"),o=r.length;o?e=[]:c+="&only_last=1"}var k=1,s="";$.getJSONS3(c,function(a){var b,c,f,h=0;$.each(a.option,function(){b=this["@value"];c=this.$;typeof c==="undefined"&&
(c="");if(o)e.push(["<option value='",b,"'>",c,"</option>"].join(""));else if(n){f="id_"+i+"-"+h;e.push(["<td><input id='",f,"' name='",i,"' value='",b,"' type='checkbox'><label for='",f,"'>",c,"</label></td>"].join(""));h++}numeric_value=+b;if(numeric_value>k){k=numeric_value;s=c}});if(q){p.val(s);j.val(k).change()}if(o){if(t)for(var g=["_0","_none","_default"],l,v=d.split("_").slice(0,-1).join("_"),a=0;a<g.length;a++){l=g[a];self.parent.$("#"+v+l).empty().append(e.join(""))}else{r.remove();j.append(e.join("")).val(k).change()}j.val(k).change()}else if(n){var m=
[];self.parent.$("#"+d+" input").each(function(){$(this).prop("checked")&&m.push($(this).val())});g=[];for(a=h=0;a<e.length;a++)if(h===0){g.push("<tr>");g.push(e[a]);h++}else if(h==u-1){g.push(e[a]);g.push("</tr>");h=0}else{g.push(e[a]);h++}j.html(g.join(""));m.push(k);for(a=0;a<m.length;a++)self.parent.$("#"+d+' input[value="'+m[a]+'"]').prop("checked",true)}self.parent.s3_popup_remove()})}}}
function getQueryParams(b){for(var b=b.split("?")[1],b=b.split("&"),d={},c=[],a=0;a<b.length;a++)c=b[a].split("="),d[decodeURIComponent(c[0])]=decodeURIComponent(c[1]);return d};
