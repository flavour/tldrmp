var s3_gis_locationselector2=function(a,e,c,m,h,d,g,k){k&&$("#"+a).data("specific",k);k=$("#"+a+"__row .map_wrapper").attr("id",a+"_map_wrapper");var f=$("#"+a+"_L0__row"),b=$("#"+a+"_L1__row"),r=$("#"+a+"_L2__row"),s=$("#"+a+"_L3__row"),p=$("#"+a+"_L4__row"),q=$("#"+a+"_L5__row");$("#"+a+"__row").hide().after(k).after(q).after(p).after(s).after(r).after(b).after(f);e&&lx_select(a,0,e);c&&lx_select(a,1,c);m&&lx_select(a,2,m);h&&lx_select(a,3,h);d&&lx_select(a,4,d);g&&lx_select(a,5,g);$("#"+a+"_L0").change(function(){lx_select(a,
0)});$("#"+a+"_L1").change(function(){lx_select(a,1)});$("#"+a+"_L2").change(function(){lx_select(a,2)});$("#"+a+"_L3").change(function(){lx_select(a,3)});$("#"+a+"_L4").change(function(){lx_select(a,4)});$("#"+a+"_L5").change(function(){lx_select(a,5)})};
function lx_select(a,e,c){var m=$("#"+a+"_lat"),h=$("#"+a+"_lon"),d=m.val(),g=h.val();d&&m.data("lat",d);g&&h.data("lon",g);m.val("");h.val("");$("#"+a+"_map_wrapper").hide();c?$("#"+a+"_L"+e).val(c):c=$("#"+a+"_L"+e).val();if(c){var k=$("#"+a);k.val(c);for(d=e+1;6>d;d++)$("#"+a+"_L"+d+"__row").hide();e+=1;d=$("#"+a+"_L"+e+"__row");if(d.length){d.show();var f=!0,b;for(b in l)l[b].f==c&&(f=!1);f&&readHierarchy(a,e,c);f=[];for(b in l)v=l[b],v.l==e&&v.f==c&&(v.i=b,f.push(v));f.sort(nameSort);var r,s,
d=$("#"+a+"_L"+e);$("#"+a+"_L"+e+" option").remove('[value != ""]');b=0;for(e=f.length;b<e;b++)r=f[b],g=r.i,s=c==g?' selected="selected"':"",g='<option value="'+g+'"'+s+">"+r.n+"</option>",d.append(g)}else{$("#"+a+"_map_wrapper").show();var p;if(S3.gis.mapPanel)p=S3.gis.mapPanel.map;else{p=S3.gis.show_map();var d=m.data("lat"),g=h.data("lon"),q=k.data("specific");q&&k.val(q);void 0!=d&&(m.val(d),h.val(g),b=new OpenLayers.Geometry.Point(parseFloat(g),parseFloat(d)),b.transform(S3.gis.proj4326,p.getProjectionObject()),
b=new OpenLayers.Feature.Vector(b),S3.gis.draftLayer.addFeatures([b]),$("#"+a+"_parent").val(c),q||k.val("dummy"));d=p.controls;b=0;for(e=d.length;b<e;b++)"OpenLayers.Control.DrawFeature"==d[b].CLASS_NAME&&(f=d[b]);f&&f.events.register("featureadded",null,function(b){b=b.feature.geometry.getBounds().getCenterLonLat();b.transform(p.getProjectionObject(),S3.gis.proj4326);m.val(b.lat);h.val(b.lon);$("#"+a+"_parent").val(c);q||k.val("dummy")})}b=l[c].b;if(!b&&(f=l[c].f,f=l[f]))if(b=f.b,!b&&(f=f.f,f=l[f]))if(b=
f.b,!b&&(f=f.f,f=l[f]))b=f.b;b&&(b=OpenLayers.Bounds.fromArray(b).transform(S3.gis.proj4326,S3.gis.projection_current),p.zoomToExtent(b))}}else{0===e?$("#"+a).val(""):(c=$("#"+a+"_L"+(e-1)).val(),$("#"+a).val(c));for(d=e+1;6>d;d++)$("#"+a+"_L"+d+"__row").hide()}}function nameSort(a,e){a=a.n;var c=[a,e.n];c.sort();return c[0]==a?-1:1}
function readHierarchy(a,e,c){$("#"+a+"_L"+e+"__throbber").show();c=S3.Ap.concat("/gis/ldata/"+c);$("#"+a+"_L"+(e+1)+"__row").length||(c+="/b");$.ajax({async:!1,url:c,success:function(c){for(var h in n)l[h]=n[h];n=null;$("#"+a+"_L"+e+"__throbber").hide()},error:function(a,c,d){msg="UNAUTHORIZED"==d?i18n.gis_requires_login:a.responseText},dataType:"script"})};
