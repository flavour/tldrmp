var s3_gis_locationselector2=function(b,c,a,g,k,m,p,e){var f="#"+b,h=$(f);e&&h.data("specific",e);e=$(f+"__row .map_wrapper").attr("id",b+"_map_wrapper");var d=$(f+"_L0__row"),r=$(f+"_L1__row"),q=$(f+"_L2__row"),s=$(f+"_L3__row"),t=$(f+"_L4__row"),u=$(f+"_L5__row"),h=h.next(".error_wrapper");$(f+"__row").hide().after(e).after(u).after(t).after(s).after(q).after(r).after(d).after(h);c&&lx_select(b,0,c);a&&lx_select(b,1,a);g&&lx_select(b,2,g);k&&lx_select(b,3,k);m&&lx_select(b,4,m);p&&lx_select(b,5,
p);$(f+"_L0").change(function(){lx_select(b,0)});$(f+"_L1").change(function(){lx_select(b,1)});$(f+"_L2").change(function(){lx_select(b,2)});$(f+"_L3").change(function(){lx_select(b,3)});$(f+"_L4").change(function(){lx_select(b,4)});$(f+"_L5").change(function(){lx_select(b,5)})};
function lx_select(b,c,a){var g="#"+b,k=$(g),m=$(g+"_lat"),p=$(g+"_lon"),e=m.val(),f=p.val();e&&m.data("lat",e);f&&p.data("lon",f);m.val("");p.val("");$(g+"_map_wrapper").hide();a?$(g+"_L"+c).val(a):a=$(g+"_L"+c).val();if(a){k.val(a);for(e=c+1;6>e;e++)$(g+"_L"+e+"__row").hide();c+=1;e=$(g+"_L"+c+"__row");if(e.length){e.show();var h=!0,d;for(d in l)l[d].f==a&&(h=!1);h&&readHierarchy(b,c,a);h=[];for(d in l)v=l[d],v.l==c&&v.f==a&&(v.i=d,h.push(v));h.sort(nameSort);g=$("#"+b+"_L"+c);$("#"+b+"_L"+c+" option").remove('[value != ""]');
d=0;for(b=h.length;d<b;d++)e=h[d],c=e.i,f=a==c?' selected="selected"':"",c='<option value="'+c+'"'+f+">"+e.n+"</option>",g.append(c)}else{$(g+"_map_wrapper").show();$(g+"_parent").val(a);var r=k.data("specific");r&&k.val(r);e=m.data("lat");f=p.data("lon");void 0!=e&&(m.val(e),p.val(f));if(S3.gis.mapPanel)q=S3.gis.mapPanel.map;else{var q=S3.gis.show_map();void 0!=e&&(d=new OpenLayers.Geometry.Point(parseFloat(f),parseFloat(e)),d.transform(S3.gis.proj4326,q.getProjectionObject()),d=new OpenLayers.Feature.Vector(d),
S3.gis.draftLayer.addFeatures([d]),r||k.val("dummy"));c=q.controls;d=0;for(b=c.length;d<b;d++)"OpenLayers.Control.DrawFeature"==c[d].CLASS_NAME&&(h=c[d]);h&&h.events.register("featureadded",null,function(a){a=a.feature.geometry.getBounds().getCenterLonLat();a.transform(q.getProjectionObject(),S3.gis.proj4326);m.val(a.lat);p.val(a.lon);r||k.val("dummy")})}d=l[a].b;if(!d&&(a=l[a].f,a=l[a]))if(d=a.b,!d&&(a=a.f,a=l[a]))if(d=a.b,!d&&(a=a.f,a=l[a]))d=a.b;d&&(d=OpenLayers.Bounds.fromArray(d).transform(S3.gis.proj4326,
S3.gis.projection_current),q.zoomToExtent(d))}}else{0===c?k.val(""):(a=$(g+"_L"+(c-1)).val(),k.val(a));for(e=c+1;6>e;e++)$(g+"_L"+e+"__row").hide()}}function nameSort(b,c){b=b.n;var a=[b,c.n];a.sort();return a[0]==b?-1:1}
function readHierarchy(b,c,a){var g="#"+b;$(g+"_L"+c+"__throbber").show();b=S3.Ap.concat("/gis/ldata/"+a);$(g+"_L"+(c+1)+"__row").length||(b+="/b");$.ajax({async:!1,url:b,success:function(a){for(var b in n)l[b]=n[b];n=null;$(g+"_L"+c+"__throbber").hide()},error:function(a,b,c){msg="UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText},dataType:"script"})};
